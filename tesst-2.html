<!DOCTYPE html>
<html lang="vi">
<head>
    <title>ÄÆ°á»ng Ä‘i Luxembourg - HÃ  Ná»™i</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        html, body, #map { height: 100%; width: 100%; }
        
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 250px;
        }
        
        button {
            margin: 5px 0;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
        }
        
        #animate {
            background: #4CAF50;
            color: white;
        }
        
        #animate:hover {
            background: #45a049;
        }
        
        #animate.animating {
            background: #f44336;
        }
        
        #reset {
            background: #2196F3;
            color: white;
        }
        
        #reset:hover {
            background: #1976D2;
        }
        
        .info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            max-width: 300px;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 2000;
        }
    </style>
</head>
<body>
<div id="loading" class="loading">
    Äang táº£i báº£n Ä‘á»“...
</div>

<div id="map"></div>

<div class="controls" style="display: none;" id="controls">
    <div style="margin-bottom: 10px; font-weight: bold;">Äiá»u khiá»ƒn</div>
    <button id="animate">Báº¯t Ä‘áº§u Animation</button>
    <button id="reset">Äáº·t láº¡i</button>
</div>

<div class="info">
    <strong>Tuyáº¿n Ä‘Æ°á»ng:</strong><br>
    ğŸ‡±ğŸ‡º Luxembourg â†’ ğŸ‡»ğŸ‡³ HÃ  Ná»™i<br>
    <strong>Khoáº£ng cÃ¡ch:</strong> ~9,500 km
</div>

<script>
    console.log('Báº¯t Ä‘áº§u khá»Ÿi táº¡o báº£n Ä‘á»“...');
    
    // Tá»a Ä‘á»™ Ä‘iá»ƒm Ä‘áº§u vÃ  Ä‘iá»ƒm cuá»‘i (Ä‘áº£m báº£o Ä‘Ãºng Ä‘á»‹nh dáº¡ng [longitude, latitude])
    const startPoint = [6.9154974, 49.1831625]; // Luxembourg
    const endPoint = [105.7803042, 21.0338925]; // HÃ  Ná»™i
    
    console.log('Äiá»ƒm báº¯t Ä‘áº§u:', startPoint);
    console.log('Äiá»ƒm káº¿t thÃºc:', endPoint);
    
    // Khá»Ÿi táº¡o báº£n Ä‘á»“
    const map = new maplibregl.Map({
        container: 'map',
        style: {
            'version': 8,
            'sources': {
                'osm': {
                    'type': 'raster',
                    'tiles': [
                        'https://tile.openstreetmap.org/{z}/{x}/{y}.png'
                    ],
                    'tileSize': 256,
                    'attribution': 'Â© OpenStreetMap contributors'
                }
            },
            'layers': [
                {
                    'id': 'osm',
                    'type': 'raster',
                    'source': 'osm'
                }
            ]
        },
        center: [56, 35], // Trung Ä‘iá»ƒm giá»¯a Luxembourg vÃ  HÃ  Ná»™i
        zoom: 2
    });

    // Táº¡o Ä‘Æ°á»ng tháº³ng Ä‘Æ¡n giáº£n giá»¯a hai Ä‘iá»ƒm
    function createSimplePath(start, end, numPoints = 50) {
        const path = [];
        for (let i = 0; i <= numPoints; i++) {
            const ratio = i / numPoints;
            const lon = start[0] + (end[0] - start[0]) * ratio;
            const lat = start[1] + (end[1] - start[1]) * ratio;
            path.push([lon, lat]);
        }
        return path;
    }

    // Táº¡o Ä‘Æ°á»ng Ä‘i
    const fullPath = createSimplePath(startPoint, endPoint, 100);
    console.log('ÄÆ°á»ng Ä‘i Ä‘Ã£ táº¡o, sá»‘ Ä‘iá»ƒm:', fullPath.length);
    
    // GeoJSON data
    const animatedLineData = {
        'type': 'FeatureCollection',
        'features': [{
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }]
    };
    
    const fullLineData = {
        'type': 'FeatureCollection',
        'features': [{
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': fullPath
            }
        }]
    };
    
    const markersData = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'properties': { 'name': 'Luxembourg', 'type': 'start' },
                'geometry': { 'type': 'Point', 'coordinates': startPoint }
            },
            {
                'type': 'Feature',
                'properties': { 'name': 'HÃ  Ná»™i', 'type': 'end' },
                'geometry': { 'type': 'Point', 'coordinates': endPoint }
            }
        ]
    };

    let animationId;
    let animationStep = 0;
    let isAnimating = false;

    map.on('load', () => {
        console.log('Báº£n Ä‘á»“ Ä‘Ã£ load xong');
        
        // áº¨n loading
        document.getElementById('loading').style.display = 'none';
        document.getElementById('controls').style.display = 'block';
        
        // ThÃªm sources
        map.addSource('full-line', {
            'type': 'geojson',
            'data': fullLineData
        });
        
        map.addSource('animated-line', {
            'type': 'geojson',
            'data': animatedLineData
        });
        
        map.addSource('markers', {
            'type': 'geojson',
            'data': markersData
        });

        // ThÃªm layers
        // ÄÆ°á»ng ná»n (Ä‘Æ°á»ng Ä‘áº§y Ä‘á»§ má»)
        map.addLayer({
            'id': 'full-line-layer',
            'type': 'line',
            'source': 'full-line',
            'layout': {
                'line-cap': 'round',
                'line-join': 'round'
            },
            'paint': {
                'line-color': '#cccccc',
                'line-width': 3,
                'line-opacity': 0.6,
                'line-dasharray': [3, 3]
            }
        });

        // ÄÆ°á»ng animation
        map.addLayer({
            'id': 'animated-line-layer',
            'type': 'line',
            'source': 'animated-line',
            'layout': {
                'line-cap': 'round',
                'line-join': 'round'
            },
            'paint': {
                'line-color': '#FF6B6B',
                'line-width': 5,
                'line-opacity': 1
            }
        });

        // Markers
        map.addLayer({
            'id': 'markers-layer',
            'type': 'circle',
            'source': 'markers',
            'paint': {
                'circle-radius': [
                    'case',
                    ['==', ['get', 'type'], 'start'], 10,
                    12
                ],
                'circle-color': [
                    'case',
                    ['==', ['get', 'type'], 'start'], '#4CAF50',
                    '#FF4444'
                ],
                'circle-stroke-color': '#ffffff',
                'circle-stroke-width': 3
            }
        });

        // ThÃªm labels cho markers
        map.addLayer({
            'id': 'markers-labels',
            'type': 'symbol',
            'source': 'markers',
            'layout': {
                'text-field': ['get', 'name'],
                'text-font': ['Open Sans Regular'],
                'text-offset': [0, 2],
                'text-anchor': 'top',
                'text-size': 14
            },
            'paint': {
                'text-color': '#000000',
                'text-halo-color': '#ffffff',
                'text-halo-width': 2
            }
        });

        // Fit view Ä‘á»ƒ hiá»ƒn thá»‹ cáº£ hai Ä‘iá»ƒm
        const bounds = new maplibregl.LngLatBounds();
        bounds.extend(startPoint);
        bounds.extend(endPoint);
        map.fitBounds(bounds, { 
            padding: 80,
            maxZoom: 4
        });
        
        console.log('CÃ¡c layer Ä‘Ã£ Ä‘Æ°á»£c thÃªm thÃ nh cÃ´ng');
    });

    // HÃ m animation
    function animate() {
        if (animationStep >= fullPath.length) {
            // Káº¿t thÃºc animation
            isAnimating = false;
            document.getElementById('animate').textContent = 'Báº¯t Ä‘áº§u láº¡i';
            document.getElementById('animate').classList.remove('animating');
            return;
        }

        // Cáº­p nháº­t Ä‘Æ°á»ng animation
        const currentPath = fullPath.slice(0, animationStep + 1);
        animatedLineData.features[0].geometry.coordinates = currentPath;
        map.getSource('animated-line').setData(animatedLineData);
        
        animationStep += 1;
        
        if (isAnimating) {
            animationId = requestAnimationFrame(() => {
                setTimeout(animate, 50); // Tá»‘c Ä‘á»™ animation (50ms = 20fps)
            });
        }
    }

    // Xá»­ lÃ½ sá»± kiá»‡n buttons
    document.getElementById('animate').addEventListener('click', () => {
        console.log('Animation button clicked');
        
        if (!isAnimating) {
            if (animationStep >= fullPath.length) {
                // Reset if animation completed
                animationStep = 0;
                animatedLineData.features[0].geometry.coordinates = [];
                map.getSource('animated-line').setData(animatedLineData);
            }
            
            isAnimating = true;
            document.getElementById('animate').textContent = 'Dá»«ng láº¡i';
            document.getElementById('animate').classList.add('animating');
            animate();
        } else {
            isAnimating = false;
            document.getElementById('animate').textContent = 'Tiáº¿p tá»¥c';
            document.getElementById('animate').classList.remove('animating');
            cancelAnimationFrame(animationId);
        }
    });

    document.getElementById('reset').addEventListener('click', () => {
        console.log('Reset button clicked');
        
        isAnimating = false;
        animationStep = 0;
        cancelAnimationFrame(animationId);
        
        animatedLineData.features[0].geometry.coordinates = [];
        map.getSource('animated-line').setData(animatedLineData);
        
        document.getElementById('animate').textContent = 'Báº¯t Ä‘áº§u Animation';
        document.getElementById('animate').classList.remove('animating');
    });

    // Xá»­ lÃ½ lá»—i
    map.on('error', (e) => {
        console.error('Map error:', e);
    });
    
    console.log('Script Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p hoÃ n táº¥t');
</script>
</body>
</html>