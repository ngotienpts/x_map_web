<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Lấy Tọa Độ Node</title>
</head>
<body>
    <h1>Tọa Độ Các Node</h1>
    <pre id="result"></pre>

    <script>
        (async () => {
            const url = new URL(window.location.href);
            const nodesParam = url.searchParams.get('nodes');
            const nodeIds = nodesParam ? nodesParam.split(',') : [];

            const nodeCoordinates = [];

            for (const nodeId of nodeIds) {
                const jsonUrl = `https://api.xmap.vn/node/${nodeId}.json`;
                try {
                    const response = await fetch(jsonUrl);
                    
                    // Kiểm tra phản hồi có thành công không
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.elements && data.elements.length > 0) {
                        const node = data.elements[0];
                        const { lat, lon } = node;
                        nodeCoordinates.push({ id: nodeId, lat, lon });
                    }
                } catch (error) {
                    console.error(`Lỗi khi tải dữ liệu cho node ${nodeId}:`, error);
                }
            }

            console.log('Mảng chứa tọa độ của các node:', nodeCoordinates);

            // Hiển thị kết quả ra màn hình
            const resultElement = document.getElementById('result');
            resultElement.textContent = JSON.stringify(nodeCoordinates, null, 2);
        })();
    </script>
</body>
</html>